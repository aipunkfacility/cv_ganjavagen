# debug-astro-site

Специализированный навык для глубокой диагностики и исправления ошибок в проектах на Astro.

## Когда использовать

- Ошибки сборки (build errors) или рантайма в dev-режиме.
- Проблемы с гидратацией компонентов (Islands architecture).
- Некорректное поведение SSR/SSG.
- Конфликты в `astro.config.mjs` или интеграциях (Tailwind, React, и т.д.).
- Проблемы со стилями и скроллом (Scroll Snap).

## Принципы

1. **Системный подход**: Анализ начинается с конфигурации, затем логи терминала, затем код компонентов.
2. **Изоляция**: Если ошибка в компоненте, проверьте его работу отдельно от Layout.
3. **Версионность**: Всегда учитывать версию Astro и используемых адаптеров.

## Workflow

### 1. Первичный анализ

- [ ] Проверить `package.json` на наличие конфликтующих зависимостей.
- [ ] Изучить `astro.config.mjs` (output mode, integrations, adapters).

### 2. Диагностика ошибок

- [ ] **Терминал**: Искать ошибки в консоли при запуске `npm run dev`.
- [ ] **Браузер**: Проверять Client-side отладку (Console, Network).
- [ ] **SSR**: Проверять, не используются ли браузерные API (window, document) внутри серверных скриптов без проверки `import.meta.env.SSR`.

### 3. Исправление и проверка

- [ ] Очистка кэша: `rm -rf .astro` и перезапуск.
- [ ] Проверка типов: `npx astro check`.

## Примеры (Few-Shot)

**Вход**: Ошибка "window is not defined" в компоненте Header.
**Решение**:

1. Проверить секцию `---` (фронтматтер).
2. Обернуть вызовы window в `if (!import.meta.env.SSR) { ... }` или перенести в `<script>`.
3. Добавить директиву `client:load` если скрипту нужен доступ к DOM.

**Вход**: Стиль Scroll Snap не работает.
**Решение**:

1. Проверить `height` родительского контейнера (должен быть фиксированным, напр. `100vh`).
2. Убедиться, что `overflow-y` установлен на `auto` или `scroll` именно у контейнера со `scroll-snap-type`.
3. Проверить `scroll-snap-align` у дочерних элементов.
